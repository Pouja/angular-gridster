/*
 * angular-gridster
 * http://manifestwebdesign.github.io/angular-gridster
 *
 * @version: 0.11.1
 * @license: MIT
 */
!function(a){"use strict";a.module("gridster",[]).constant("gridsterConfig",{columns:6,pushing:!0,floating:!0,swapping:!1,width:"auto",colWidth:"auto",rowHeight:"match",margins:[10,10],outerMargin:!0,multiGridster:{enabled:!1},isMobile:!1,mobileBreakPoint:600,mobileModeEnabled:!0,minColumns:1,minRows:1,maxRows:100,defaultSizeX:2,defaultSizeY:1,minSizeX:1,maxSizeX:null,minSizeY:1,maxSizeY:null,saveGridItemCalculatedHeightInMobile:!1,resizable:{enabled:!0,handles:["s","e","n","w","se","ne","sw","nw"]},draggable:{enabled:!0,scrollSensitivity:20,scrollSpeed:20}}).factory("GridsterMaster",function(){var a=[];return{register:function(b){a.push(b)},unregister:function(b){for(var c=0;c<a.length-1;c++)a[c]===b&&a.splice(c,1)},findClosestGridster:function(b){return a.reduce(function(a,c){return a.distanceToMe(b)<c.distanceToMe(b)?a:c})}}}).controller("GridsterCtrl",["gridsterConfig",function(b){a.extend(this,b),this.resizable=a.extend({},b.resizable||{}),this.draggable=a.extend({},b.draggable||{}),this.grid=[],this.destroy=function(){this.grid&&(this.grid.length=0,this.grid=null)},this.setOptions=function(b){if(b)if(b=a.extend({},b),b.draggable&&(a.extend(this.draggable,b.draggable),delete b.draggable),b.resizable&&(a.extend(this.resizable,b.resizable),delete b.resizable),a.extend(this,b),this.margins&&2===this.margins.length)for(var c=0,d=this.margins.length;d>c;++c)this.margins[c]=parseInt(this.margins[c],10),isNaN(this.margins[c])&&(this.margins[c]=0);else this.margins=[0,0]},this.canItemOccupy=function(a,b,c){return b>-1&&c>-1&&a.sizeX+c<=this.columns&&a.sizeY+b<=this.maxRows},this.autoSetItemPosition=function(a){for(var b=0;b<this.maxRows;++b)for(var c=0;c<this.columns;++c){var d=this.getItems(b,c,a.sizeX,a.sizeY,a);if(0===d.length&&this.canItemOccupy(a,b,c))return void this.putItem(a,b,c)}throw new Error("Unable to place item!")},this.getItems=function(a,b,c,d,e){var f=[];c&&d||(c=d=1),!e||e instanceof Array||(e=[e]);for(var g=0;d>g;++g)for(var h=0;c>h;++h){var i=this.getItem(a+g,b+h,e);!i||e&&-1!==e.indexOf(i)||-1!==f.indexOf(i)||f.push(i)}return f},this.removeItem=function(a){for(var b=0,c=this.grid.length;c>b;++b){var d=this.grid[b];if(d){var e=d.indexOf(a);if(-1!==e){d[e]=null;break}}}this.floatItemsUp(),this.updateHeight()},this.getItem=function(a,b,c){!c||c instanceof Array||(c=[c]);for(var d=1;a>-1;){for(var e=1,f=b;f>-1;){var g=this.grid[a];if(g){var h=g[f];if(h&&(!c||-1===c.indexOf(h))&&h.sizeX>=e&&h.sizeY>=d)return h}++e,--f}--a,++d}return null},this.putItems=function(a){for(var b=0,c=a.length;c>b;++b)this.putItem(a[b])},this.putItem=function(a,b,c,d){if(("undefined"==typeof b||null===b)&&(b=a.row,c=a.col,"undefined"==typeof b||null===b))return void this.autoSetItemPosition(a);if(this.canItemOccupy(a,b,c)||(c=Math.min(this.columns-a.sizeX,Math.max(0,c)),b=Math.min(this.maxRows-a.sizeY,Math.max(0,b))),a&&null!==a.oldRow&&"undefined"!=typeof a.oldRow){if(a.oldRow===b&&a.oldColumn===c)return a.row=b,void(a.col=c);var e=this.grid[a.oldRow];e&&e[a.oldColumn]===a&&delete e[a.oldColumn]}a.oldRow=a.row=b,a.oldColumn=a.col=c,this.moveOverlappingItems(a,d),this.grid[b]||(this.grid[b]=[]),this.grid[b][c]=a},this.swapItems=function(a,b){this.grid[a.row][a.col]=b,this.grid[b.row][b.col]=a;var c=a.row,d=a.col;a.row=b.row,a.col=b.col,b.row=c,b.col=d},this.moveOverlappingItems=function(a,b){b?-1===b.indexOf(a)&&(b=b.slice(0),b.push(a)):b=[a];var c=this.getItems(a.row,a.col,a.sizeX,a.sizeY,b);this.moveItemsDown(c,a.row+a.sizeY,b)},this.moveItemsDown=function(a,b,c){if(a&&0!==a.length){a.sort(function(a,b){return a.row-b.row}),c=c?c.slice(0):[];var d,e,f,g={};for(e=0,f=a.length;f>e;++e){d=a[e];var h=g[d.col];("undefined"==typeof h||d.row<h)&&(g[d.col]=d.row)}for(e=0,f=a.length;f>e;++e){d=a[e];var i=b-g[d.col];this.moveItemDown(d,d.row+i,c),c.push(d)}}},this.moveItemDown=function(a,b,c){if(!(a.row>=b)){for(;a.row<b;)++a.row,this.moveOverlappingItems(a,c);this.putItem(a,a.row,a.col,c)}},this.floatItemsUp=function(){if(this.floating!==!1)for(var a=0,b=this.grid.length;b>a;++a){var c=this.grid[a];if(c)for(var d=0,e=c.length;e>d;++d)c[d]&&this.floatItemUp(c[d])}},this.floatItemUp=function(a){if(this.floating!==!1){for(var b=a.col,c=a.sizeY,d=a.sizeX,e=null,f=null,g=a.row-1;g>-1;){var h=this.getItems(g,b,d,c,a);if(0!==h.length)break;e=g,f=b,--g}null!==e&&this.putItem(a,e,f)}},this.updateHeight=function(a){var b=this.minRows;a=a||0;for(var c=this.grid.length;c>=0;--c){var d=this.grid[c];if(d)for(var e=0,f=d.length;f>e;++e)d[e]&&(b=Math.max(b,c+a+d[e].sizeY))}this.gridHeight=this.maxRows-b>0?Math.min(this.maxRows,b):Math.max(this.maxRows,b)},this.pixelsToRows=function(a,b){return b===!0?Math.ceil(a/this.curRowHeight):b===!1?Math.floor(a/this.curRowHeight):Math.round(a/this.curRowHeight)},this.pixelsToColumns=function(a,b){return b===!0?Math.ceil(a/this.curColWidth):b===!1?Math.floor(a/this.curColWidth):Math.round(a/this.curColWidth)},this.unifiedInput=function(a,b,c,d){var e,f,g={},h=function(a){if(Object.keys)return Object.keys(a).length;var b,c=0;for(b in a)++c;return c},i=function(a){for(var b=0,c=0,d=a;null!=d;d=d.offsetParent)navigator.userAgent.match(/\bMSIE\b/)&&(!document.documentMode||document.documentMode<8)&&"relative"===d.currentStyle.position&&d.offsetParent&&"relative"===d.offsetParent.currentStyle.position&&d.offsetLeft===d.offsetParent.offsetLeft?c+=d.offsetTop:(b+=d.offsetLeft,c+=d.offsetTop);return{x:b,y:c}},j=i(a),k=function(e){if("mousemove"!==e.type||0!==h(g)){for(var f=!0,m=e.changedTouches?e.changedTouches:[e],n=0;n<m.length;++n){var o=m[n],p="undefined"!=typeof o.identifier?o.identifier:"undefined"!=typeof o.pointerId?o.pointerId:1;if("undefined"==typeof o.pageX)if(o.pageX=o.offsetX+j.x,o.pageY=o.offsetY+j.y,o.srcElement.offsetParent===a&&document.documentMode&&8===document.documentMode&&"mousedown"===o.type)o.pageX+=o.srcElement.offsetLeft,o.pageY+=o.srcElement.offsetTop;else if(o.srcElement!==a&&!document.documentMode||document.documentMode<8){for(var q=-2,r=-2,s=o.srcElement;null!==s;s=s.parentNode)q+=s.scrollLeft?s.scrollLeft:0,r+=s.scrollTop?s.scrollTop:0;o.pageX=o.clientX+q,o.pageY=o.clientY+r}var t=o.pageX,u=o.pageY;e.type.match(/(start|down)$/i)?(j=i(a),g[p]&&(d&&d({target:e.target,which:e.which,pointerId:p,pageX:t,pageY:u}),delete g[p]),b&&f&&(f=b({target:e.target,which:e.which,pointerId:p,pageX:t,pageY:u})),g[p]={x:t,y:u},a.msSetPointerCapture?a.msSetPointerCapture(p):"mousedown"===e.type&&1===h(g)&&(l?a.setCapture(!0):(document.addEventListener("mousemove",k,!1),document.addEventListener("mouseup",k,!1)))):e.type.match(/move$/i)?!g[p]||g[p].x===t&&g[p].y===u||(c&&f&&(f=c({target:e.target,which:e.which,pointerId:p,pageX:t,pageY:u})),g[p].x=t,g[p].y=u):g[p]&&e.type.match(/(up|end|cancel)$/i)&&(d&&f&&(f=d({target:e.target,which:e.which,pointerId:p,pageX:t,pageY:u})),delete g[p],a.msReleasePointerCapture?a.msReleasePointerCapture(p):"mouseup"===e.type&&0===h(g)&&(l?a.releaseCapture():(document.removeEventListener("mousemove",k,!1),document.removeEventListener("mouseup",k,!1))))}f&&(e.preventDefault&&e.preventDefault(),e.preventManipulation&&e.preventManipulation(),e.preventMouseEvent&&e.preventMouseEvent())}},l=!1;return this.enable=function(){window.navigator.msPointerEnabled?(a.addEventListener("MSPointerDown",k,!1),a.addEventListener("MSPointerMove",k,!1),a.addEventListener("MSPointerUp",k,!1),a.addEventListener("MSPointerCancel",k,!1),"undefined"!=typeof a.style.msContentZooming&&(e=a.style.msContentZooming,a.style.msContentZooming="none"),"undefined"!=typeof a.style.msTouchAction&&(f=a.style.msTouchAction,a.style.msTouchAction="none")):a.addEventListener?(a.addEventListener("touchstart",k,!1),a.addEventListener("touchmove",k,!1),a.addEventListener("touchend",k,!1),a.addEventListener("touchcancel",k,!1),a.addEventListener("mousedown",k,!1),a.setCapture&&!window.navigator.userAgent.match(/\bGecko\b/)&&(l=!0,a.addEventListener("mousemove",k,!1),a.addEventListener("mouseup",k,!1))):a.attachEvent&&a.setCapture&&(l=!0,a.attachEvent("onmousedown",function(){return k(window.event),window.event.returnValue=!1,!1}),a.attachEvent("onmousemove",function(){return k(window.event),window.event.returnValue=!1,!1}),a.attachEvent("onmouseup",function(){return k(window.event),window.event.returnValue=!1,!1}))},this.disable=function(){window.navigator.msPointerEnabled?(a.removeEventListener("MSPointerDown",k,!1),a.removeEventListener("MSPointerMove",k,!1),a.removeEventListener("MSPointerUp",k,!1),a.removeEventListener("MSPointerCancel",k,!1),e&&(a.style.msContentZooming=e),f&&(a.style.msTouchAction=f)):a.removeEventListener?(a.removeEventListener("touchstart",k,!1),a.removeEventListener("touchmove",k,!1),a.removeEventListener("touchend",k,!1),a.removeEventListener("touchcancel",k,!1),a.removeEventListener("mousedown",k,!1),a.setCapture&&!window.navigator.userAgent.match(/\bGecko\b/)&&(l=!0,a.removeEventListener("mousemove",k,!1),a.removeEventListener("mouseup",k,!1))):a.detachEvent&&a.setCapture&&(l=!0,a.detachEvent("onmousedown"),a.detachEvent("onmousemove"),a.detachEvent("onmouseup"))},this}}]).directive("gridster",["$timeout","$rootScope","$window","GridsterMaster","RectangleHelper",function(b,c,d,e,f){return{restrict:"EAC",transclude:!0,replace:!0,template:'<div ng-class="gridsterClass()"><div ng-style="previewStyle()" class="gridster-item gridster-preview-holder"></div><div class="gridster-content" ng-transclude></div></div>',controller:"GridsterCtrl",controllerAs:"gridster",scope:{config:"=?gridster"},compile:function(){return function(g,h,i,j){function k(){var a=h[0].offsetWidth||parseInt(h.css("width"),10);a&&a!==o&&!j.movingItem&&(o=a,j.loaded&&h.removeClass("gridster-loaded"),m(),j.loaded&&h.addClass("gridster-loaded"),g.$parent.$broadcast("gridster-resized",[a,h.offsetHeight]))}function l(){k(),b(function(){g.$apply()})}j.loaded=!1,g.gridsterClass=function(){return{gridster:!0,"gridster-desktop":!j.isMobile,"gridster-mobile":j.isMobile,"gridster-loaded":j.loaded}},g.previewStyle=function(){return j.movingItem?{display:"block",height:j.movingItem.sizeY*j.curRowHeight-j.margins[0]+"px",width:j.movingItem.sizeX*j.curColWidth-j.margins[1]+"px",top:j.movingItem.row*j.curRowHeight+(j.outerMargin?j.margins[0]:0)+"px",left:j.movingItem.col*j.curColWidth+(j.outerMargin?j.margins[1]:0)+"px"}:{display:"none"}};var m=function(){j.setOptions(g.config),j.multiGridster.enabled&&e.register(j),j.curWidth="auto"===j.width?h[0].offsetWidth||parseInt(h.css("width"),10):j.width,j.curColWidth="auto"===j.colWidth?Math.round((j.curWidth+(j.outerMargin?-j.margins[1]:j.margins[1]))/j.columns):j.colWidth,j.curRowHeight=j.rowHeight,"string"==typeof j.rowHeight&&("match"===j.rowHeight?j.curRowHeight=Math.round(j.curColWidth):-1!==j.rowHeight.indexOf("*")?j.curRowHeight=Math.round(j.curColWidth*j.rowHeight.replace("*","").replace(" ","")):-1!==j.rowHeight.indexOf("/")&&(j.curRowHeight=Math.round(j.curColWidth/j.rowHeight.replace("/","").replace(" ","")))),j.isMobile=j.mobileModeEnabled&&j.curWidth<=j.mobileBreakPoint;for(var a=0,b=j.grid.length;b>a;++a){var c=j.grid[a];if(c)for(var d=0,f=c.length;f>d;++d)if(c[d]){var i=c[d];i.setElementPosition(),i.setElementSizeY(),i.setElementSizeX()}}n()};j.dataModel=i.model,j.distanceToMe=function(a){var b=h[0].getBoundingClientRect(),c=a[0].getBoundingClientRect();if(null===h[0].offsetParent)return Number.MAX_VALUE;var d=f.distance(b,c);return 0===d?Number.MIN_VALUE:d},g.$watch("config",m,!0),g.$watch("config.draggable",function(){c.$broadcast("gridster-draggable-changed")},!0),g.$watch("config.resizable",function(){c.$broadcast("gridster-resizable-changed")},!0);var n=function(){h.css("height",j.gridHeight*j.curRowHeight+(j.outerMargin?j.margins[0]:-j.margins[0])+"px")};g.$watch("gridster.gridHeight",n);var o=h[0].offsetWidth||parseInt(h.css("width"),10);"function"==typeof h.resize&&h.resize(l);var p=a.element(d);p.on("resize",l),g.$watch(function(){return h[0].offsetWidth||parseInt(h.css("width"),10)},k),g.$on("$destroy",function(){j.destroy(),e.unregister(g),p.off("resize",l)}),b(function(){g.$watch("gridster.floating",function(){j.floatItemsUp()}),j.loaded=!0},100)}}}}]).controller("GridsterItemCtrl",function(){this.$element=null,this.gridster=null,this.row=null,this.col=null,this.sizeX=null,this.sizeY=null,this.minSizeX=0,this.minSizeY=0,this.maxSizeX=null,this.maxSizeY=null,this.init=function(a,b){this.$element=a,this.gridster=b,this.sizeX=b.defaultSizeX,this.sizeY=b.defaultSizeY},this.destroy=function(){this.gridster=null,this.$element=null},this.toJSON=function(){return{row:this.row,col:this.col,sizeY:this.sizeY,sizeX:this.sizeX}},this.isMoving=function(){return this.gridster.movingItem===this},this.setPosition=function(a,b){this.gridster.putItem(this,a,b),this.gridster.loaded&&this.gridster.floatItemsUp(),this.gridster.updateHeight(this.isMoving()?this.sizeY:0),this.isMoving()||this.setElementPosition()},this.setSize=function(a,b){a=a.toUpperCase();var c="size"+a,d="Size"+a;if(""!==b){b=parseInt(b,10),(isNaN(b)||0===b)&&(b=this.gridster["default"+d]);var e="X"===a?this.gridster.columns:this.gridster.maxRows;this["max"+d]&&(e=Math.min(this["max"+d],e)),this.gridster["max"+d]&&(e=Math.min(this.gridster["max"+d],e)),"X"===a&&this.cols?e-=this.cols:"Y"===a&&this.rows&&(e-=this.rows);var f=0;this["min"+d]&&(f=Math.max(this["min"+d],f)),this.gridster["min"+d]&&(f=Math.max(this.gridster["min"+d],f)),b=Math.max(Math.min(b,e),f);var g=!(this[c]===b&&this["old"+d]&&this["old"+d]===b);this["old"+d]=this[c]=b,this.isMoving()||this["setElement"+d](),g&&(this.gridster.moveOverlappingItems(this),this.gridster.loaded&&this.gridster.floatItemsUp(),this.gridster.updateHeight(this.isMoving()?this.sizeY:0))}},this.setSizeY=function(a){this.setSize("Y",a)},this.setSizeX=function(a){this.setSize("X",a)},this.setElementPosition=function(){this.$element.css(this.gridster.isMobile?{marginLeft:this.gridster.margins[0]+"px",marginRight:this.gridster.margins[0]+"px",marginTop:this.gridster.margins[1]+"px",marginBottom:this.gridster.margins[1]+"px",top:"",left:""}:{margin:0,top:this.row*this.gridster.curRowHeight+(this.gridster.outerMargin?this.gridster.margins[0]:0)+"px",left:this.col*this.gridster.curColWidth+(this.gridster.outerMargin?this.gridster.margins[1]:0)+"px"})},this.setElementSizeY=function(){this.gridster.isMobile&&!this.gridster.saveGridItemCalculatedHeightInMobile?this.$element.css("height",""):this.$element.css("height",this.sizeY*this.gridster.curRowHeight-this.gridster.margins[0]+"px")},this.setElementSizeX=function(){this.gridster.isMobile?this.$element.css("width",""):this.$element.css("width",this.sizeX*this.gridster.curColWidth-this.gridster.margins[1]+"px")}}).factory("GridsterDraggable",["$document","$timeout","$window",function(b,c,d){function e(e,f,g,h,i){function j(b){if(-1!==G.indexOf(b.target.nodeName.toLowerCase()))return!1;if(a.element(b.target).hasClass("gridster-item-resizable-handler"))return!1;switch(b.which){case 1:break;case 2:case 3:return}return y=b.pageX,z=b.pageY,p=parseInt(e.css("left"),10),q=parseInt(e.css("top"),10),r=e[0].offsetWidth,s=e[0].offsetHeight,t=h.col,u=h.row,m(b),!0}function k(a){if(!e.hasClass("gridster-item-moving")||e.hasClass("gridster-item-resizing"))return!1;var b=g.curWidth-1;w=a.pageX,x=a.pageY;var c=w-y+A,d=x-z+B;A=B=0,y=w,z=x;var f=c,h=d;return g.multiGridster.enabled||(E>p+f?(c=E-p,A=f-c):p+r+f>b&&(c=b-p-r,A=f-c),C>q+h?(d=C-q,B=h-d):q+s+h>D&&(d=D-q-s,B=h-d)),p+=c,q+=d,e.css({top:q+"px",left:p+"px"}),n(a),!0}function l(a){return!e.hasClass("gridster-item-moving")||e.hasClass("gridster-item-resizing")?!1:(A=B=0,o(a),!0)}function m(a){e.addClass("gridster-item-moving"),g.movingItem=h,g.updateHeight(h.sizeY),f.$apply(function(){g.draggable&&g.draggable.start&&g.draggable.start(a,e,i)})}function n(a){var b=h.row,c=h.col,j=g.draggable&&g.draggable.drag,k=g.draggable.scrollSensitivity,l=g.draggable.scrollSpeed,m=g.pixelsToRows(q),n=g.pixelsToColumns(p),o=g.getItems(m,n,h.sizeX,h.sizeY,h),r=0!==o.length;if(g.swapping===!0&&r){var s=o[0],t=s.sizeX===h.sizeX&&s.sizeY===h.sizeY,u=s.row===m,v=s.col===n,w=u&&v,x=u||v;if(w&&t)g.swapItems(h,s);else if(t&&x)return}g.pushing===!1&&r||(h.row=m,h.col=n),a.pageY-F.body.scrollTop<k?F.body.scrollTop=F.body.scrollTop-l:d.innerHeight-(a.pageY-F.body.scrollTop)<k&&(F.body.scrollTop=F.body.scrollTop+l),a.pageX-F.body.scrollLeft<k?F.body.scrollLeft=F.body.scrollLeft-l:d.innerWidth-(a.pageX-F.body.scrollLeft)<k&&(F.body.scrollLeft=F.body.scrollLeft+l),(j||b!==h.row||c!==h.col)&&f.$apply(function(){j&&g.draggable.drag(a,e,i)})}function o(a){e.removeClass("gridster-item-moving");var b=g.pixelsToRows(q),c=g.pixelsToColumns(p);(g.pushing!==!1||0===g.getItems(b,c,h.sizeX,h.sizeY,h).length)&&(h.row=b,h.col=c),g.movingItem=null,g.isValidMove&&!g.isValidMove(a,e,i,h)&&(h.row=u,h.col=t),h.setPosition(h.row,h.col),h.setSizeY(h.sizeY),h.setSizeX(h.sizeX),f.$apply(function(){g.draggable&&g.draggable.stop&&g.draggable.stop(a,e,i)})}var p,q,r,s,t,u,v,w=0,x=0,y=0,z=0,A=0,B=0,C=0,D=9999,E=0,F=b[0],G=["select","input","textarea","button"],H=!1,I=null;this.enable=function(){var b=this;c(function(){b.disable(),g.draggable&&g.draggable.handle?(I=a.element(e[0].querySelector(g.draggable.handle)),0===I.length&&(I=e)):I=e,v=new g.unifiedInput(I[0],j,k,l),v.enable(),H=!0})},this.disable=function(){H&&(v.disable(),v=void 0,H=!1)},this.toggle=function(a){a?this.enable():this.disable()},this.destroy=function(){this.disable()}}return e}]).factory("GridsterResizable",[function(){function b(b,c,d,e,f){function g(g){function h(a){switch(a.which){case 1:break;case 2:case 3:return}return v=d.draggable.enabled,v&&(d.draggable.enabled=!1,c.$broadcast("gridster-draggable-changed")),A=a.pageX,B=a.pageY,n=parseInt(b.css("left"),10),o=parseInt(b.css("top"),10),p=b[0].offsetWidth,q=b[0].offsetHeight,r=e.sizeX,s=e.sizeY,t=e.row,u=e.col,i(a),!0}function i(a){b.addClass("gridster-item-moving"),b.addClass("gridster-item-resizing"),d.movingItem=e,e.setElementSizeX(),e.setElementSizeY(),e.setElementPosition(),d.updateHeight(1),c.$apply(function(){d.resizable&&d.resizable.start&&d.resizable.start(a,b,f)})}function j(a){var c=d.curWidth-1;y=a.pageX,z=a.pageY;var e=y-A+C,f=z-B+D;C=D=0,A=y,B=z;var g=f,h=e;return x.indexOf("n")>=0&&(H>q-g?(f=q-H,D=g-f):E>o+g&&(f=E-o,D=g-f),o+=f,q-=f),x.indexOf("s")>=0&&(H>q+g?(f=H-q,D=g-f):o+q+g>F&&(f=F-o-q,D=g-f),q+=f),x.indexOf("w")>=0&&(I>p-h?(e=p-I,C=h-e):G>n+h&&(e=G-n,C=h-e),n+=e,p-=e),x.indexOf("e")>=0&&(I>p+h?(e=I-p,C=h-e):n+p+h>c&&(e=c-n-p,C=h-e),p+=e),b.css({top:o+"px",left:n+"px",width:p+"px",height:q+"px"}),l(a),!0}function k(a){return d.draggable.enabled!==v&&(d.draggable.enabled=v,c.$broadcast("gridster-draggable-changed")),C=D=0,m(a),!0}function l(a){var g=e.row,h=e.col,i=e.sizeX,j=e.sizeY,k=d.resizable&&d.resizable.resize,l=d.pixelsToRows(o,!1),m=d.pixelsToColumns(n,!1),r=d.pixelsToColumns(p,!0),s=d.pixelsToRows(q,!0);(d.pushing!==!1||0===d.getItems(l,m,r,s,e).length)&&(e.row=l,e.col=m,e.sizeX=r,e.sizeY=s);var t=e.row!==g||e.col!==h||e.sizeX!==i||e.sizeY!==j;(k||t)&&c.$apply(function(){k&&d.resizable.resize(a,b,f)})}function m(a){b.removeClass("gridster-item-moving"),b.removeClass("gridster-item-resizing"),d.movingItem=null,d.isValidMove&&!d.isValidMove(a,b,f,e)&&(e.row=t,e.col=u,e.sizeX=r,e.sizeY=s),e.setPosition(e.row,e.col),e.setSizeY(e.sizeY),e.setSizeX(e.sizeX),c.$apply(function(){d.resizable&&d.resizable.stop&&d.resizable.stop(a,b,f)})}var n,o,p,q,r,s,t,u,v,w,x=g,y=0,z=0,A=0,B=0,C=0,D=0,E=0,F=9999,G=0,H=d.curRowHeight-d.margins[0],I=d.curColWidth-d.margins[1],J=null;this.enable=function(){J||(J=a.element('<div class="gridster-item-resizable-handler handle-'+x+'"></div>'),b.append(J)),w=new d.unifiedInput(J[0],h,j,k),w.enable()},this.disable=function(){J&&(J.remove(),J=null),w.disable(),w=void 0},this.destroy=function(){this.disable()}}var h=[],i=d.resizable.handles;"string"==typeof i&&(i=d.resizable.handles.split(","));for(var j=!1,k=0,l=i.length;l>k;k++)h.push(new g(i[k]));this.enable=function(){if(!j){for(var a=0,b=h.length;b>a;a++)h[a].enable();j=!0}},this.disable=function(){if(j){for(var a=0,b=h.length;b>a;a++)h[a].disable();j=!1}},this.toggle=function(a){a?this.enable():this.disable()},this.destroy=function(){for(var a=0,b=h.length;b>a;a++)h[a].destroy()}}return b}]).directive("gridsterItem",["$parse","GridsterDraggable","GridsterResizable","GridsterMaster",function(a,b,c,d){return{restrict:"EA",controller:"GridsterItemCtrl",require:["^gridster","gridsterItem"],link:function(e,f,g,h){function i(){o.setPosition(o.row,o.col),r.row&&r.row.assign&&r.row.assign(e,o.row),r.col&&r.col.assign&&r.col.assign(e,o.col)}function j(){o.setSizeX(o.sizeX),r.sizeX&&r.sizeX.assign&&r.sizeX.assign(e,o.sizeX),o.setSizeY(o.sizeY),r.sizeY&&r.sizeY.assign&&r.sizeY.assign(e,o.sizeY)}function k(){var a=document.createElement("div"),b={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(var c in b)if(void 0!==a.style[c])return b[c]}var l,m=g.gridsterItem,n=h[0],o=h[1];if(m){var p=a(m);l=p(e)||{},!l&&p.assign&&(l={row:o.row,col:o.col,sizeX:o.sizeX,sizeY:o.sizeY,minSizeX:0,minSizeY:0,maxSizeX:null,maxSizeY:null},p.assign(e,l))}else l=g;o.init(f,n),f.addClass("gridster-item");for(var q=["minSizeX","maxSizeX","minSizeY","maxSizeY","sizeX","sizeY","row","col"],r={},s=function(b){var c;if("string"==typeof l[b])c=l[b];else if("string"==typeof l[b.toLowerCase()])c=l[b.toLowerCase()];else{if(!m)return;c=a(m+"."+b)}r[b]=a(c),e.$watch(c,function(a){a=parseInt(a,10),isNaN(a)||(o[b]=a)});var d=r[b](e);"number"==typeof d&&(o[b]=d)},t=0,u=q.length;u>t;++t)s(q[t]);e.$watch(function(){return o.row+","+o.col},i),e.$watch(function(){return o.sizeY+","+o.sizeX+"|"+o.minSizeX+","+o.maxSizeX+","+o.minSizeY+","+o.maxSizeY},j);var v=new b(f,e,n,o,l),w=new c(f,e,n,o,l);return e.$on("gridster-draggable-changed",function(){v.toggle(!n.isMobile&&n.draggable&&n.draggable.enabled)}),e.$on("gridster-resizable-changed",function(){w.toggle(!n.isMobile&&n.resizable&&n.resizable.enabled)}),e.$on("gridster-resized",function(){w.toggle(!n.isMobile&&n.resizable&&n.resizable.enabled)}),e.$watch(function(){return n.isMobile},function(){w.toggle(!n.isMobile&&n.resizable&&n.resizable.enabled),v.toggle(!n.isMobile&&n.draggable&&n.draggable.enabled)}),f.on(k(),function(){e.$apply(function(){e.$broadcast("gridster-item-transition-end")})}),n.multiGridster.enabled&&(o.dataModel=g.model,f.on("mouseup",function(){var a=d.findClosestGridster(f);a!==n&&n.multiGridster.callback(n,a,o)})),e.$on("$destroy",function(){try{w.destroy(),v.destroy()}catch(a){}try{n.removeItem(o)}catch(a){}try{o.destroy()}catch(a){}})}}}]).factory("RectangleHelper",function(){return{hasInner:function(a,b){var c={x:a.left,y:a.top},d={x:a.right,y:a.bottom},e={x:b.left,y:b.top},f={x:b.right,y:b.bottom};return c.x<=e.x&&d.x>=f.x&&c.y<=e.y&&d.y>=f.y},distance:function(a,b){if(this.hasInner(a,b))return 0;var c={x:(a.left+a.right)/2,y:(a.top+a.bottom)/2},d={x:(b.left+b.right)/2,y:(b.top+b.bottom)/2};return Math.sqrt(Math.pow(c.x-d.x,2)+Math.pow(c.y-d.y,2))}}})}(angular);